{% load i18n %}
<nav class="top-nav">
  <!-- inline SVG sprite used by nav icons -->
  <svg style="display:none;" aria-hidden="true">
    <symbol id="icon-home" viewBox="0 0 24 24"><path d="M12 3l9 8h-3v8h-4v-5H10v5H6v-8H3z"/></symbol>
    <symbol id="icon-progress" viewBox="0 0 24 24"><path d="M3 17h2v-7H3v7zm4 0h2v-11H7v11zm4 0h2v-4h-2v4zm4 0h2v-9h-2v9zm4 0h2v-2h-2v2z"/></symbol>
    <symbol id="icon-profile" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-4 0-8 2-8 5v1h16v-1c0-3-4-5-8-5z"/></symbol>
    <symbol id="icon-calculator" viewBox="0 0 24 24"><path d="M7 2h10v20H7V2zm2 2v4h6V4H9zm0 6h2v2H9v-2zm4 0h2v2h-2v-2zM9 14h2v2H9v-2zm4 0h2v2h-2v-2z"/></symbol>
    <symbol id="icon-login" viewBox="0 0 24 24"><path d="M10 17l5-5-5-5v3H3v4h7v3z"/></symbol>
    <symbol id="icon-logout" viewBox="0 0 24 24"><path d="M16 13v-2H8V8l-5 4 5 4v-3zM20 3h-8v2h8v14h-8v2h8c1.1 0 2-0.9 2-2V5c0-1.1-0.9-2-2-2z"/></symbol>
    <symbol id="icon-signup" viewBox="0 0 24 24"><path d="M19 11h-4V7h-2v4H9v2h4v4h2v-4h4z"/></symbol>
  </svg>

  <div class="nav-left">
    <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" href="{% url 'nutrition:home' %}" title="{% trans 'Home' %}">
      <svg class="nav-icon" aria-hidden="true"><use href="#icon-home"></use></svg>
      <span class="nav-text">{% trans "Home" %}</span>
    </a>

    <a class="nav-link {% if request.resolver_match.url_name == 'progress' %}active{% endif %}" href="{% url 'nutrition:progress' %}" title="{% trans 'Progress' %}">
      <svg class="nav-icon" aria-hidden="true"><use href="#icon-progress"></use></svg>
      <span class="nav-text">{% trans "Progress" %}</span>
    </a>

    <a class="nav-link {% if request.resolver_match.url_name == 'calculator' %}active{% endif %}" href="{% url 'nutrition:calculator' %}" title="{% trans 'Calculator' %}">
      <svg class="nav-icon" aria-hidden="true"><use href="#icon-calculator"></use></svg>
      <span class="nav-text">{% trans "Calculator" %}</span>
    </a>

    {% if user.is_authenticated %}
      <a class="nav-link {% if request.resolver_match.url_name == 'profile' %}active{% endif %}" href="{% url 'nutrition:profile' %}" title="{% trans 'Profile' %}">
        <svg class="nav-icon" aria-hidden="true"><use href="#icon-profile"></use></svg>
        <span class="nav-text">{% trans "Profile" %}</span>
      </a>
    {% endif %}
  </div>

  <div class="nav-right">
    <form action="{% url 'set_language' %}" method="post" class="language-card" id="langForm" title="{% trans 'Change language' %}">
      {% csrf_token %}
      <select name="language" class="nav-lang-select" onchange="this.form.submit();" aria-label="{% trans 'Language' %}">
        <option value="en"{% if LANGUAGE_CODE|slice:":2" == "en" %} selected{% endif %}>EN</option>
        <option value="lv"{% if LANGUAGE_CODE|slice:":2" == "lv" %} selected{% endif %}>LV</option>
        <option value="ru"{% if LANGUAGE_CODE|slice:":2" == "ru" %} selected{% endif %}>RU</option>
      </select>
      <input type="hidden" name="next" value="{{ request.path }}">
    </form>

    <div class="auth-links" role="navigation" aria-label="{% trans 'Account' %}">
      {% if user.is_authenticated %}
        {# Заменено: вместо ссылки на профиль показываем POST-форму выхода #}
        <form action="{% url 'nutrition:logout' %}" method="post" class="logout-form" title="{% trans 'Logout' %}">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.path }}">
          <button type="submit" class="account-btn" aria-label="{% trans 'Logout' %}" title="{% trans 'Logout' %}">
            <svg class="nav-icon" aria-hidden="true"><use href="#icon-logout"></use></svg>
          </button>
        </form>
      {% else %}
        <a class="account-btn" href="{% url 'nutrition:login' %}" title="{% trans 'Login / Sign up' %}">
          <svg class="nav-icon" aria-hidden="true"><use href="#icon-login"></use></svg>
        </a>
      {% endif %}
    </div>
  </div>
</nav>
